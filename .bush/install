#! /usr/bin/env bash
eval "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
execute_sudo bash -c "printf '%s\n%s\n' \"$HOMEBREW_PREFIX/bin\" \"\$(cat /etc/paths)\" > /etc/paths"

eval "$($HOMEBREW_PREFIX/bin/brew shellenv)"
curl -fsSL https://raw.githubusercontent.com/xko/bush/mac/.bush/Brewfile | brew bundle -q --file=- --no-lock

execute_sudo bash -c "echo $HOMEBREW_PREFIX/bin/bash >> /etc/shells"

exec_v () {
    ohai "$@"
    "$@"
}

finger "$USER" | grep "$HOMEBREW_PREFIX/bin/bash" >/dev/null || {
    exec_v chsh -s "$HOMEBREW_PREFIX/bin/bash"
}

exec_v brew tap homebrew/cask-fonts
exec_v brew install --cask font-jetbrains-mono-nerd-font

exec_v cd "$HOME"
exec_v git init
git remote | grep -e "^bush$" >/dev/null || exec_v git remote add -f bush https://github.com/xko/bush
exec_v git merge bush/mac

exec_v brew install --cask iterm2
